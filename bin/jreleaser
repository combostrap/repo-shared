#!/usr/bin/env bash
# jreleaser wrapper to inject secrets env

set -TCEeuo pipefail

if [ -z "$ORGANISATION_PATH_NAME" ]; then
  echo "ERROR: ORGANISATION_PATH_NAME environment variable is not set"
  exit 1
fi

export JRELEASER_MAVENCENTRAL_USERNAME
JRELEASER_MAVENCENTRAL_USERNAME=$(pass "$ORGANISATION_PATH_NAME/sonatype/username")

export JRELEASER_MAVENCENTRAL_PASSWORD
JRELEASER_MAVENCENTRAL_PASSWORD=$(pass "$ORGANISATION_PATH_NAME/sonatype/password")

export JRELEASER_GPG_PASSPHRASE
JRELEASER_GPG_PASSPHRASE=$(pass "$ORGANISATION_PATH_NAME/gpg/software-signing-key-passphrase")

export JRELEASER_GITHUB_TOKEN
JRELEASER_GITHUB_TOKEN=$(pass "$ORGANISATION_PATH_NAME/github/release-token")

# For snapshot
export JRELEASER_NEXUS2_USERNAME="${JRELEASER_MAVENCENTRAL_USERNAME}"
export JRELEASER_NEXUS2_PASSWORD="${JRELEASER_MAVENCENTRAL_PASSWORD}"

# Run
"$(which -a jreleaser | tail -1)" "$@"
