#!/usr/bin/env bash
# mvnw wrapper to inject secrets env
# used in deploy script
# ref: https://jreleaser.org/guide/latest/examples/maven/maven-central.html#_maven

set -TCEeuo pipefail

if [ -z "$PROJECT_ORGANISATION_NAME" ]; then
  echo "ERROR: PROJECT_ORGANISATION_NAME environment variable is not set"
  exit 1
fi
PROJECT_ORGANISATION_NAME_NORMALIZED=$(echo "$PROJECT_ORGANISATION_NAME" | tr '[:upper:]' '[:lower:]' | tr '_' '-' )

export JRELEASER_MAVENCENTRAL_USERNAME
JRELEASER_MAVENCENTRAL_USERNAME=$(pass "$PROJECT_ORGANISATION_NAME_NORMALIZED/sonatype/username")

export JRELEASER_MAVENCENTRAL_PASSWORD
JRELEASER_MAVENCENTRAL_PASSWORD=$(pass "$PROJECT_ORGANISATION_NAME_NORMALIZED/sonatype/password")

export JRELEASER_GPG_PASSPHRASE
JRELEASER_GPG_PASSPHRASE=$(pass "$PROJECT_ORGANISATION_NAME_NORMALIZED/gpg/software-signing-key-passphrase")

export JRELEASER_GITHUB_TOKEN
JRELEASER_GITHUB_TOKEN=$(pass "$PROJECT_ORGANISATION_NAME_NORMALIZED/github/release-token")

# For snapshot
export JRELEASER_NEXUS2_USERNAME="${JRELEASER_MAVENCENTRAL_USERNAME}"
export JRELEASER_NEXUS2_PASSWORD="${JRELEASER_MAVENCENTRAL_PASSWORD}"

# Run
"$PROJECT_ROOT/mvnw" "$@"